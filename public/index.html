<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QOTD // Quote of The Day</title>
    <meta name="description" content="Daily inspirational quotes from history's greatest minds. Discover wisdom from philosophers, strategists, and thinkers. A new quote every day.">
    <meta name="keywords" content="quotes, daily quotes, inspiration, wisdom, philosophy, motivation">
    <meta name="author" content="qotd">
    <meta name="theme-color" content="#15191F">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://qotd.example.com/">
    <meta property="og:title" content="qotd // Quote of The Day">
    <meta property="og:description" content="Daily inspirational quotes from history's greatest minds. A new quote every day.">
    <meta property="og:image" content="https://qotd.example.com/og-image.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://qotd.example.com/">
    <meta name="twitter:title" content="qotd // Quote of The Day">
    <meta name="twitter:description" content="Daily inspirational quotes from history's greatest minds. A new quote every day.">
    <meta name="twitter:image" content="https://qotd.example.com/og-image.png">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="author" href="/humans.txt">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Permanent+Marker&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
    <div class="layout">
        <div class="background-text" aria-hidden="true">QOTD</div>
        <div class="grid-overlay" aria-hidden="true"></div>
        
        <header class="header">
            <div class="header-left">
                <a href="#" class="logo" id="logo-link">qotd//</a>
                <span class="date" id="current-date"></span>
            </div>
            <div class="header-buttons">
                <a href="https://github.com/xzao/qotd" target="_blank" rel="noopener noreferrer" class="github-btn" aria-label="View on GitHub">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                        <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
                    </svg>
                </a>
                <button id="refresh-btn" class="refresh-btn hidden" aria-label="Back to quote of the day">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                        <path d="M21 3v5h-5"/>
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                        <path d="M3 21v-5h5"/>
                    </svg>
                </button>
                <button id="random-btn" class="random-btn" aria-label="Random quote">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
                    </svg>
                </button>
                <button id="copy-btn" class="copy-btn" aria-label="Copy quote">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>
            </div>
        </header>
        
        <main class="main">
            <div id="quote-container" class="quote-display">
                <div class="loading">Loading...</div>
            </div>
        </main>
        
        <footer class="footer">
            <div class="accent-line"></div>
        </footer>
    </div>

    <!-- Copy notification -->
    <div id="copy-notification" class="copy-notification">Copied</div>

    <script>
        // Store current quote data
        let currentQuote = null;
        let quoteOfTheDayData = null;
        let quotesIndex = null;

        // Update current date display
        function updateDate() {
            const dateEl = document.getElementById('current-date');
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateEl.textContent = today.toLocaleDateString('en-US', options);
        }
        
        // Display a quote
        function displayQuote(quoteData) {
            // Store current quote for copying
            currentQuote = quoteData;
            
            const container = document.getElementById('quote-container');
            const authorLine = quoteData.source 
                ? `${quoteData.author}, ${quoteData.source}`
                : quoteData.author;
            
            const displayYear = quoteData.year || 'Unknown';
            const displayTags = quoteData.tags ? quoteData.tags.join(' Â· ') : '';
            
            container.innerHTML = `
                <div class="quote-date">${displayTags}</div>
                <blockquote class="quote-text">"${quoteData.text}"</blockquote>
                <div class="quote-meta">
                    <cite class="quote-author">${authorLine}</cite>
                    <span class="quote-tags">${displayYear}</span>
                </div>
            `;
        }
        
        // Load quote by key (filename without .json)
        async function loadQuoteByKey(quoteKey) {
            try {
                const container = document.getElementById('quote-container');
                container.innerHTML = '<div class="loading">Loading...</div>';
                
                if (!quotesIndex) {
                    const indexResponse = await fetch('/data/quotes/index.json');
                    quotesIndex = await indexResponse.json();
                }
                
                // Find the quote file
                const quoteFile = quotesIndex.items.find(f => f === `${quoteKey}.json`);
                
                if (!quoteFile) {
                    throw new Error(`Quote not found: ${quoteKey}`);
                }
                
                // Fetch the quote file
                const quoteResponse = await fetch(`/data/quotes/items/${quoteFile}`);
                const quoteData = await quoteResponse.json();
                
                displayQuote(quoteData);
            } catch (error) {
                console.error('Error loading quote:', error);
                document.getElementById('quote-container').innerHTML = `
                    <div class="error">Failed to load quote</div>
                `;
            }
        }
        
        // Load quote of the day (deterministic, same for everyone on the same day)
        async function loadQuoteOfTheDay(updateHash = true) {
            try {
                const container = document.getElementById('quote-container');
                container.innerHTML = '<div class="loading">Loading...</div>';
                
                // Fetch the index to get list of quotes
                if (!quotesIndex) {
                    const indexResponse = await fetch('/data/quotes/index.json');
                    quotesIndex = await indexResponse.json();
                }
                
                // Calculate days since Unix epoch (Jan 1, 1970)
                const epoch = new Date('1970-01-01');
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Normalize to start of day
                const daysSinceEpoch = Math.floor((today - epoch) / (1000 * 60 * 60 * 24));
                
                // Select quote deterministically based on day
                const quoteIndex = daysSinceEpoch % quotesIndex.items.length;
                const quoteFile = quotesIndex.items[quoteIndex];
                
                // Fetch the quote file
                const quoteResponse = await fetch(`/data/quotes/items/${quoteFile}`);
                const quoteData = await quoteResponse.json();
                
                // Store the quote of the day
                quoteOfTheDayData = quoteData;
                
                displayQuote(quoteData);
                
                // Update URL hash with quote key (filename without .json)
                if (updateHash) {
                    const quoteKey = quoteFile.replace('.json', '');
                    history.replaceState(null, '', `#${quoteKey}`);
                }
                
                // Hide refresh button when on QOTD
                document.getElementById('refresh-btn').classList.add('hidden');
            } catch (error) {
                console.error('Error loading quote:', error);
                document.getElementById('quote-container').innerHTML = `
                    <div class="error">Failed to load quote</div>
                `;
            }
        }
        
        // Load random quote
        async function loadRandomQuote() {
            try {
                const container = document.getElementById('quote-container');
                container.innerHTML = '<div class="loading">Loading...</div>';
                
                // Fetch the index to get list of quotes
                if (!quotesIndex) {
                    const indexResponse = await fetch('/data/quotes/index.json');
                    quotesIndex = await indexResponse.json();
                }
                
                // Select random quote
                const quoteIndex = Math.floor(Math.random() * quotesIndex.items.length);
                const quoteFile = quotesIndex.items[quoteIndex];
                
                // Fetch the quote file
                const quoteResponse = await fetch(`/data/quotes/items/${quoteFile}`);
                const quoteData = await quoteResponse.json();
                
                displayQuote(quoteData);
                
                // Update URL hash with quote key (filename without .json)
                const quoteKey = quoteFile.replace('.json', '');
                history.pushState(null, '', `#${quoteKey}`);
                
                // Show the refresh button after shuffling
                document.getElementById('refresh-btn').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading quote:', error);
                document.getElementById('quote-container').innerHTML = `
                    <div class="error">Failed to load quote</div>
                `;
            }
        }

        // Copy quote to clipboard
        function copyQuoteToClipboard() {
            if (!currentQuote) return;
            
            // Format: "quote text" - Author (year)
            const year = currentQuote.year || 'Unknown';
            const copyText = `"${currentQuote.text}" - ${currentQuote.author} (${year})`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(copyText).then(() => {
                // Show notification
                const notification = document.getElementById('copy-notification');
                notification.classList.add('show');
                
                // Hide notification after 2 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // Pull-to-refresh functionality for mobile
        let touchStartY = 0;
        let touchEndY = 0;
        let isPulling = false;
        
        function handleTouchStart(e) {
            if (window.scrollY === 0) {
                touchStartY = e.touches[0].clientY;
            }
        }
        
        function handleTouchMove(e) {
            if (touchStartY === 0) return;
            
            touchEndY = e.touches[0].clientY;
            const pullDistance = touchEndY - touchStartY;
            
            if (pullDistance > 80 && window.scrollY === 0 && !isPulling) {
                isPulling = true;
            }
        }
        
        function handleTouchEnd() {
            if (isPulling) {
                isPulling = false;
                // Trigger shuffle and animate button
                const shuffleBtn = document.getElementById('random-btn');
                shuffleBtn.classList.add('active');
                setTimeout(() => shuffleBtn.classList.remove('active'), 300);
                loadRandomQuote();
            }
            touchStartY = 0;
            touchEndY = 0;
        }

        // Handle hash-based navigation
        async function handleHashChange() {
            const hash = window.location.hash.slice(1); // Remove the # character
            
            if (!hash) {
                // No hash, load quote of the day
                loadQuoteOfTheDay(true);
                return;
            }
            
            // Load the specific quote by key
            await loadQuoteByKey(hash);
            
            // Check if this is today's quote
            if (!quotesIndex) {
                const indexResponse = await fetch('/data/quotes/index.json');
                quotesIndex = await indexResponse.json();
            }
            
            const epoch = new Date('1970-01-01');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const daysSinceEpoch = Math.floor((today - epoch) / (1000 * 60 * 60 * 24));
            const qotdIndex = daysSinceEpoch % quotesIndex.items.length;
            const qotdFile = quotesIndex.items[qotdIndex].replace('.json', '');
            
            // Show/hide refresh button based on whether this is QOTD
            if (hash === qotdFile) {
                document.getElementById('refresh-btn').classList.add('hidden');
            } else {
                document.getElementById('refresh-btn').classList.remove('hidden');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDate();
            
            // Check for hash on initial load
            const hash = window.location.hash.slice(1);
            if (hash) {
                handleHashChange();
            } else {
                loadQuoteOfTheDay(true);
            }
            
            // Listen for hash changes (back/forward navigation)
            window.addEventListener('hashchange', handleHashChange);
            
            // Logo click - go to quote of the day
            document.getElementById('logo-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadQuoteOfTheDay(true);
                // Hide refresh button when going to QOTD
                document.getElementById('refresh-btn').classList.add('hidden');
            });
            
            // Random quote button
            document.getElementById('random-btn').addEventListener('click', () => {
                loadRandomQuote();
            });
            
            // Refresh button - back to quote of the day
            document.getElementById('refresh-btn').addEventListener('click', () => {
                loadQuoteOfTheDay(true);
                // Hide refresh button when back to QOTD
                document.getElementById('refresh-btn').classList.add('hidden');
            });
            
            // Copy button
            document.getElementById('copy-btn').addEventListener('click', copyQuoteToClipboard);
            
            // Pull-to-refresh for mobile devices
            document.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchmove', handleTouchMove, { passive: true });
            document.addEventListener('touchend', handleTouchEnd, { passive: true });
        });
    </script>
</body>
</html>
